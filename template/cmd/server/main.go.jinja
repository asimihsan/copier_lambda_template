package main

import (
	"github.com/rs/zerolog/log"
	"{{ github_path }}/internal/config"
	"{{ github_path }}/internal/handler"
	"{{ github_path }}/internal/repository"
	"{{ github_path }}/internal/server"
	"{{ github_path }}/pkg/logger"
)

func main() {
	// Load configuration
	cfg, err := config.LoadConfig()
	if err != nil {
		log.Fatal().Err(err).Msg("Failed to load configuration")
	}

	// Setup logger
	logger.Setup(cfg.LogLevel)
	log.Info().Msg("Starting application")

	// Create repository
	repo, err := repository.NewDynamoDBRepository(
		cfg.Database.DynamoDBEndpoint,
		cfg.Database.DynamoDBRegion,
		cfg.Database.DynamoDBTableName,
	)
	if err != nil {
		log.Fatal().Err(err).Msg("Failed to create repository")
	}

	// Create handler
	h := handler.NewServer(repo)

	// Create and start server
	srv := server.New(cfg, h)
	if err := srv.Start(); err != nil {
		log.Fatal().Err(err).Msg("Failed to start server")
	}
}
